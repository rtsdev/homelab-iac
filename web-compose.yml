version: "3.8"

networks:
  web:
    name: web
  db:
    name: db

services:
  authelia:
    container_name: authelia
    environment:
      PUID: 911
      PGID: 911
      TZ: America/New_York
    hostname: authelia
    image: authelia/authelia:latest
    restart: unless-stopped
    networks:
      - web
      - db
    volumes:
      - /data/authelia/config:/config

  authelia-db:
    container_name: authelia-db
    environment:
      MYSQL_ROOT_PASSWORD: ${AUTHELIA_DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${AUTHELIA_DB}
      MYSQL_USER: ${AUTHELIA_DB_USER}
      MYSQL_PASSWORD: ${AUTHELIA_DB_PASSWORD}
    hostname: authelia-db
    image: mariadb:10
    restart: unless-stopped
    networks:
      - web
      - db
    volumes:
      - /data/authelia-db:/var/lib/mysql

  authelia-redis:
    command:
      - sh
      - -c
      - redis-server --appendonly yes --requirepass $$REDIS_PASSWORD
    container_name: authelia-redis
    environment:
      REDIS_PASSWORD: ${AUTHELIA_REDIS_PASSWORD}
    hostname: authelia-redis
    image: redis:5-alpine
    restart: unless-stopped
    networks:
      - db
    volumes:
      - /data/authelia-redis:/dat
     
#   npm:
#     container_name: npm
#     environment:
#       DB_MYSQL_HOST:
#       DB_MYSQL_PORT:
#       DB_MYSQL_USER:
#       DB_MYSQL_PASSWORD:
#       DB_MYSQL_NAME:
#       DISABLE_IPV6: true
#     hostname: npm
#     image: 'jc21/nginx-proxy-manager:latest'
#     ports:
#       - '81:81'
#     restart: unless-stopped
#     volumes:
#       - /data/npm/data:/data
#       - /data/npm/letsencrypt:/etc/letsencrypt
     
#   npm-db:
#     container_name: npm-db
#     environment:
#       MYSQL_ROOT_PASSWORD: ${NPM_DB_ROOT_PASSWORD}
#       MYSQL_DATABASE: ${NPM_DB}
#       MYSQL_USER: ${NPM_DB_USER}
#       MYSQL_PASSWORD: ${NPM_DB_PASSWORD}
#     hostname: npm-db
#     image: 'jc21/mariadb-aria:latest'
#     restart: unless-stopped
#     volumes:
#       - /data/npm-db:/var/lib/mysql
      
  swag:
    cap_add:
      - NET_ADMIN
    container_name: swag
    environment:
      PUID: 911
      PGID: 911
      TZ: America/New_York
      URL: ${SWAG_URL}
      SUBDOMAINS: wildcard
      VALIDATION: dns
      DNSPLUGIN: digitalocean
      EMAIL: ${SWAG_EMAIL}
      DHLEVEL: 2048
      ONLY_SUBDOMAINS: false
      EXTRA_DOMAINS: ${SWAG_EXTRA_DOMAINS}
      STAGING: false
    hostname: swag
    image: linuxserver/swag:latest
    ports:
      - '80:80'
      - '443:443'
    restart: unless-stopped
    networks:
      - web
    volumes:
      - /data/swag:/config

